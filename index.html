<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Swisscom × beem – Protect &amp; Connect Kalkulator</title>
<style>
  :root { --bg:#f6f7fb; --card:#fff; --ink:#0f172a; --muted:#667085; --border:#e5e7eb; --primary:#0048DA; --secondary:#7A00FF; --accent:#00A3FF; }
  html,body{margin:0;background:var(--bg);color:#0f172a;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .topbar{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;padding:10px 16px;display:flex;gap:12px;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.15)}
  .logo{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.2px}
  .logo .blob{width:28px;height:28px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,rgba(255,255,255,.25) 40%,transparent 60%),conic-gradient(from 30deg,var(--secondary),var(--primary),var(--accent),var(--secondary))}
  .wrap{max-width:1200px;margin:18px auto 80px;padding:0 16px}
  h1{font-size:22px;margin:8px 0 6px}
  .subtitle{color:#667085;font-size:13px}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 16px}
  .toggle, .btn{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--border);padding:8px 12px;border-radius:10px}
  .btn{cursor:pointer;font-weight:600}
  .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  @media(max-width:920px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden}
  table{width:100%;border-collapse:collapse}
  thead th{font-weight:600;font-size:12px;text-align:left;padding:10px 12px;color:#475467;background:#f1f5ff;border-bottom:1px solid var(--border)}
  tbody td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
  .planLabel{font-weight:600}
  .money{text-align:right;font-variant-numeric: tabular-nums;white-space:nowrap}
  .qty{width:90px}
  .summary{display:grid;grid-template-columns:1fr;gap:12px;padding:12px}
  .summary .item{border:1px solid var(--border);border-radius:12px;padding:12px 14px;background:#fff}
  .summary .item h3{margin:0 0 6px;font-size:13px;color:#475467;font-weight:600}
  .summary .val{font-size:22px;font-weight:800;text-align:right}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .footnote{margin-top:8px;color:#667085;font-size:12px}
  .badge{display:inline-block;border:1px solid var(--border);padding:2px 8px;border-radius:999px;font-size:11px;color:#475467;background:#fff;margin-left:6px}
</style>
</head>
<body>
  <div class="topbar">
    <div class="logo"><div class="blob"></div> Swisscom <span style="opacity:.7">×</span> beem</div>
  </div>
  <div class="wrap">
    <h1>Protect &amp; Connect – Interaktiver Kalkulator <span class="badge">Staffel je Abo</span></h1>
    <div class="subtitle">Ausgangspreis = <b>mit Beem</b>. Berechnung nutzt Staffelpreise <b>ohne Beem</b>. KMU −15% nur auf den Anteil ohne Beem. Kein KMU für Mini &amp; Data Swiss (light/ohne Zusatz).</div>

    <div class="actions">
      <label class="toggle"><input type="checkbox" id="withBeem" checked> Beem anzeigen (+5)</label>
      <label class="toggle"><input type="checkbox" id="withKMU"> KMU −15% (eligible)</label>
      <label class="toggle"><input type="checkbox" id="withVAT"> inkl. MwSt. 8.1%</label>
      <button class="btn" id="btnReset">Zurücksetzen</button>
      <button class="btn primary" id="btnPDF">Export als PDF</button>
    </div>

    <div class="grid">
      <section class="card">
        <table>
          <thead><tr>
            <th>Mobile-/Data-Abo</th>
            <th>Ausgangspreis (mit Beem)</th>
            <th>Anzahl</th>
            <th class="money">Einzelpreis aktiv</th>
            <th class="money">Zwischensumme</th>
          </tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </section>

      <section class="card">
        <div class="summary">
          <div class="item"><h3>Summe (vor KMU)</h3><div class="val" id="sumBefore">–</div></div>
          <div class="item"><h3>KMU‑Rabatt (15%)</h3><div class="val" id="kmuDiscount">–</div></div>
          <div class="item"><h3>Gesamt‑Rabatt (Staffel + KMU, exkl. Beem)</h3><div class="val" id="totalDiscount">–</div></div>
          <div class="item"><h3>Gesamtsumme (Monat)</h3><div class="val" id="grandTotal">–</div></div>
        </div>
      </section>
    </div>

    <p class="footnote">Gesamt‑Rabatt summiert: (Staffelrabatt vom 1–4‑Preis ohne Beem) + (KMU‑Rabatt). Beem ist eine Leistung und wird nicht rabattiert.</p>
  </div>

<script>
  const PLANS = [{"plan": "Swiss mini", "tiers_excl_beem": [11.0, 10.65, 10.45, 10.0, 9.5]}, {"plan": "Swiss light", "tiers_excl_beem": [30.0, 29.1, 28.5, 27.4, 26.1]}, {"plan": "Swiss", "tiers_excl_beem": [50.0, 48.5, 47.5, 46.0, 45.0]}, {"plan": "Europe light", "tiers_excl_beem": [50.0, 48.5, 47.5, 46.0, 45.0]}, {"plan": "Europe", "tiers_excl_beem": [80.0, 77.6, 76.0, 76.0, 74.0]}, {"plan": "Neighbours", "tiers_excl_beem": [85.0, 82.45, 80.75, 80.0, 78.0]}, {"plan": "Europe advanced", "tiers_excl_beem": [100.0, 97.0, 95.0, 94.0, 92.0]}, {"plan": "Intercontinental", "tiers_excl_beem": [150.0, 145.5, 142.5, 136.0, 132.0]}, {"plan": "Global", "tiers_excl_beem": [200.0, 194.0, 190.0, 182.0, 177.0]}, {"plan": "Data Swiss light", "tiers_excl_beem": [10.0, 9.8, 9.6, 9.0, 8.5]}, {"plan": "Data Swiss", "tiers_excl_beem": [49.0, 47.0, 45.0, 43.0, 40.0]}];
  const MWST = 0.081;
  const BEEM = 5.0;
  const KMU_EXCL = ["mini", "data swiss"];

  function fmt(n){return new Intl.NumberFormat('de-CH', {style:'currency',currency:'CHF',minimumFractionDigits:2}).format(n);}
  function tierIndex(q){
    if(q>=1 && q<=4) return 0;
    if(q>=5 && q<=19) return 1;
    if(q>=20 && q<=49) return 2;
    if(q>=50 && q<=99) return 3;
    if(q>=100 && q<=249) return 4;
    return 0;
  }
  function kmuEligible(name){
    const n = String(name).toLowerCase();
    return !(KMU_EXCL.some(x => n.includes(x)));
  }

  function renderRows(){
    const tb=document.getElementById('tbody'); tb.innerHTML='';
    PLANS.forEach((p,idx)=>{
      const tr=document.createElement('tr');
      const td1=document.createElement('td'); td1.innerHTML=`<span class='planLabel'>${p.plan}</span>`; tr.appendChild(td1);

      const tdBase=document.createElement('td'); tdBase.className='money'; tdBase.id=`base-${idx}`; tr.appendChild(tdBase);

      const tdQty=document.createElement('td');
      const inp=document.createElement('input'); inp.type='number'; inp.min='0'; inp.step='1'; inp.className='qty'; inp.value=0; inp.dataset.index=idx; inp.addEventListener('input', recalc);
      tdQty.appendChild(inp); tr.appendChild(tdQty);

      const tdUnit=document.createElement('td'); tdUnit.className='money'; tdUnit.id=`unit-${idx}`; tr.appendChild(tdUnit);
      const tdSum=document.createElement('td'); tdSum.className='money'; tdSum.id=`sum-${idx}`; tr.appendChild(tdSum);

      tb.appendChild(tr);
    });
  }

  function recalc(){
    const withBeem=document.getElementById('withBeem').checked;
    const withKMU=document.getElementById('withKMU').checked;
    const withVAT=document.getElementById('withVAT').checked;

    let subtotal=0;
    let kmu_base_total=0;
    let volume_discount_total=0;
    let kmu_discount_total=0;

    document.querySelectorAll('.qty').forEach(inp=>{
      const i=parseInt(inp.dataset.index,10);
      const q=Math.max(0,parseInt(inp.value||'0',10));
      const tiers = PLANS[i].tiers_excl_beem;
      const tIdx = tierIndex(q || 1);

      const base_with_beem = tiers[0] + BEEM;
      document.getElementById(`base-${i}`).textContent = fmt(base_with_beem);

      const unit_excl = tiers[tIdx];
      const unit_excl_baseline = tiers[0];
      const unit_beem = withBeem ? BEEM : 0;
      const unit_eff = unit_excl + unit_beem;

      const row = unit_eff * q;
      document.getElementById(`unit-${i}`).textContent = fmt(unit_eff);
      document.getElementById(`sum-${i}`).textContent = fmt(row);
      subtotal += row;

      const vol_disc = Math.max(0, (unit_excl_baseline - unit_excl)) * q;
      volume_discount_total += vol_disc;

      if (withKMU && kmuEligible(PLANS[i].plan)) kmu_base_total += unit_excl * q;
    });

    kmu_discount_total = withKMU ? kmu_base_total * 0.15 : 0;
    const total_discount = volume_discount_total + kmu_discount_total;

    let total = subtotal - kmu_discount_total;
    if(withVAT) total *= (1+MWST);

    document.getElementById('sumBefore').textContent = fmt(subtotal);
    document.getElementById('kmuDiscount').textContent = (kmu_discount_total>0?'−':'') + fmt(kmu_discount_total);
    document.getElementById('totalDiscount').textContent = (total_discount>0?'−':'') + fmt(total_discount);
    document.getElementById('grandTotal').textContent = fmt(total);
  }

  document.addEventListener('change', e=>{ if(['withBeem','withKMU','withVAT'].includes(e.target.id)) recalc(); });
  document.getElementById('btnReset').addEventListener('click', ()=>{ document.querySelectorAll('.qty').forEach(inp=> inp.value=0); document.getElementById('withBeem').checked=true; document.getElementById('withKMU').checked=false; document.getElementById('withVAT').checked=false; recalc(); });
  document.getElementById('btnPDF').addEventListener('click', ()=> window.print());

  renderRows(); recalc();
</script>
</body>
</html>
